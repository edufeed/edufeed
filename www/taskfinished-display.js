// Generated by LiveScript 1.3.1
(function(){
  Polymer({
    is: 'taskfinished-display',
    properties: {},
    S: function(pattern){
      return $(this.$$(pattern));
    },
    closeTaskFinishedDisplay: function(){
      var classmates, i$, len$, classmate, name;
      console.log('close task finished display!');
      classmates = this.S('#classmate_avatars').children();
      for (i$ = 0, len$ = classmates.length; i$ < len$; ++i$) {
        classmate = classmates[i$];
        if (classmate.checked) {
          name = classmate.attributes['username'].value;
          this.fire('share-activity', {
            username: name
          });
          console.log('shared with: ' + name);
        }
      }
      return this.fire('close-taskfinished', this);
    },
    numClassmatesChecked: function(){
      var totalChecked, classmates, i$, len$, classmate;
      totalChecked = 0;
      classmates = this.S('#classmate_avatars').children();
      for (i$ = 0, len$ = classmates.length; i$ < len$; ++i$) {
        classmate = classmates[i$];
        if (classmate.checked) {
          totalChecked += 1;
        }
      }
      return totalChecked;
    },
    ready: function(){
      var self;
      self = this;
      return getBoolParam('skipsharescreen', function(skipsharescreen){
        if (skipsharescreen) {
          self.style.opacity = 0.0;
          setTimeout(function(){
            return self.fire('close-taskfinished', this);
          }, 0);
          return;
        } else {
          self.style.opacity = 1.0;
        }
        setTimeout(function(){
          return synthesize_word('share this with one friend');
        }, 1000);
        return getUsername(function(username){
          return getClassmates(username, function(all_classmates){
            var res$, i$, len$, x, classmates, classmatesPicked, maxShareTo, i, maxSharedWith, results$ = [];
            res$ = [];
            for (i$ = 0, len$ = all_classmates.length; i$ < len$; ++i$) {
              x = all_classmates[i$];
              if (x !== username) {
                res$.push(x);
              }
            }
            all_classmates = res$;
            classmates = [];
            classmatesPicked = 0;
            maxShareTo = 5;
            if (all_classmates.length <= maxShareTo) {
              maxShareTo = all_classmates.length;
            }
            while (classmatesPicked < maxShareTo) {
              i = Math.floor(Math.random() * all_classmates.length);
              if (!in$(all_classmates[i], classmates)) {
                classmates.push(all_classmates[i]);
                classmatesPicked += 1;
              }
            }
            maxSharedWith = 1;
            for (i$ = 0, len$ = classmates.length; i$ < len$; ++i$) {
              results$.push((fn$.call(this, classmates[i$])));
            }
            return results$;
            function fn$(classmate){
              var avatar;
              avatar = $("<user-avatar username='" + classmate + "' size='m'>").css({
                'cursor': 'pointer',
                'display': 'inline-block'
              });
              avatar.click(function(){
                var sharedWith;
                if (avatar.prop('checked')) {
                  return avatar.prop('checked', false);
                } else {
                  sharedWith = self.numClassmatesChecked();
                  if (sharedWith < maxSharedWith) {
                    return avatar.prop('checked', true);
                  }
                }
              });
              return avatar.appendTo(self.S('#classmate_avatars'));
            }
          });
        });
      });
    }
  });
  function in$(x, xs){
    var i = -1, l = xs.length >>> 0;
    while (++i < l) if (x === xs[i]) return true;
    return false;
  }
}).call(this);
